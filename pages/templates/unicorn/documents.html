<div class="grid grid-cols-4">

    {#  Document Management  #}
    <div class="col-span-1 px-4 justify-center h-[calc(100vh-75px)] overflow-y-auto">
        <div class="w-full pt-10">

            {#  Drag and Drop Container  #}
            <div class="bg-black p-4 mt-1 rounded-md">

                <p>Drag and drop directory</p>
                <p class="text-gray-400 text-xs">Limit 50 mb</p>
                <p class="text-gray-400 text-xs">Supported file types: docx, pdf, txt, md</p>


                <form action="/" method="post" enctype="multipart/form-data"
                      id="file-upload-form" class="mt-4">
                    {% csrf_token %}

                    <input class="text-sm" type="file" name="inpFile" id="inpFile"
                           multiple webkitdirectory="true" directory="true">

                    <button type="submit"
                            class="bg-gray-700 text-sm py-2 px-3 rounded-md mt-2 flex space-x-2 items-center"
                            id="upload-documents">
                        <div class="font-bold">Upload</div>
                        <div id="upload-spinner" class="hidden">{% include "components/loading.html" %}</div>
                    </button>

                </form>

            </div>


            {#  Show Newly Uploaded Directory in Directory List  #}
            <form action="" method="post" unicorn:submit.prevent="refreshDirectories">
                <button type="submit" class="bg-gray-700 text-sm py-2 px-3 rounded-md mt-2" id="process-new-directory"
                        hidden></button>
            </form>


            {#  Directory List  #}
            <div class="mt-12" id="directory-list">

                {% for directory in directories %}

                    <div class="directory bg-gray-900 text-sm rounded-md py-4 px-3 mb-3">

                        <div class="flex justify-between">

                            <div class="flex space-x-2 items-center">
                                {% include "components/folder.html" %}
                                <div>
                                    {{ directory.name }}
                                </div>
                            </div>

                            <div class="flex space-x-1">
                                <button class="bg-gray-700 text-xs py-1 px-2 rounded md expand-directory-btn"
                                        data-directory="{{ directory.id }}" id="expand-{{ directory.id }}"
                                        onclick="expand(this)">
                                    Expand
                                </button>

                                <button class="flex items-center space-x-2 {% if directory.embeddingdirectory.processed %}bg-emerald-600{% else %}bg-gray-700{% endif %} text-xs py-1 px-2 rounded md"
                                        unicorn:click.prevent="update_chat_selection({{ directory.id }})"
                                        id="process-document-{{ directory.id }}">

                                    <div>
                                        {% if directory.embeddingdirectory.processed %}Chat{% else %}Process{% endif %}
                                    </div>

                                    {% if not directory.embeddingdirectory.processed %}
                                        <div unicorn:loading unicorn:target="process-document-{{ directory.id }}">
                                            {% include "components/loading.html" %}
                                        </div>
                                    {% endif %}

                                </button>

                                <button class="text-sm ps-1 rounded md"
                                        unicorn:click.prevent="delete({{ directory.id }})">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                         stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
                                    </svg>

                                </button>

                            </div>

                        </div>

                        <div class="overflow-x-visible show-uploaded-directory collapsed"
                             data-directory="{{ directory.id }}">
                        </div>

                    </div>

                {% endfor %}

            </div>
        </div>

    </div>


    {#  Document Chat  #}
    <div id="chat" class="col-span-3 px-8 bg-black flex justify-center h-[calc(100vh-75px)] overflow-y-auto {% if not selected_directory %}items-center{% endif %}">
        <div class="relative w-full text-center">

            {% if not selected_directory %}
                {#  Document Chat Header  #}
                {% include "components/document-icon.html" %}
                <h1 class="text-3xl font-bold mt-4">
                    Chat with documents
                </h1>

                {#  Database State Specific message #}
                <p class="mt-2">
                    {% if directories %}Select a directory from the list{% else %}Upload directory to begin{% endif %}
                </p>
            {% endif %}

            {#  Conversation History  #}
            {% if selected_directory %}
                <div class="w-1/2 overflow-x-auto pt-10 mx-auto text-start pb-20">
                    {% for question,answer in selected_directory.chat_history.chat_history %}
                        <div>
                            <div class="bg-gray-700 text-white rounded-md p-3 mb-4">
                                {{ question }}
                            </div>
                            <div class="bg-gray-700 text-white rounded-md p-3 mb-4">
                                {{ answer|safe }}
                            </div>
                        </div>
                    {% endfor %}
                    <div id="show-document">{{ document|safe }}</div>
                </div>
            {% endif %}

            <div class="fixed bottom-2 left-3/4 w-1/2 transform -translate-x-3/4 rounded-lg">
                <form action="" method="post" unicorn:submit.prevent="respond" class="max-w-3xl mx-auto">

                    <div class="flex space-x-2 bg-gray-800 py-4 px-3 mt-2 w-full rounded-md">

                        <input unicorn:model.defer="question" type="text"
                               class="bg-transparent focus:outline-none w-full"
                               {% if not selected_directory %}disabled{% endif %}>

                        <button type="submit" {% if not selected_directory %}disabled{% endif %}>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                 class="w-6 h-6">
                                <path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"/>
                            </svg>
                        </button>

                    </div>

                </form>
            </div>
            {#  User Question upload  #}

        </div>
    </div>
</div>

